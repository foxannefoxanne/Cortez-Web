<h1>New Map</h1>
<p id="notice"><%= notice %></p>
<script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>


<%= render 'new_pin_form' %> 

<div>
  <div id="map" style='width: 100%; height: 85vh;'>
</div>
</div> 
<!--
<div style="position:absolute; width:380px; height: 100%; overflow:auto; float:left; padding-left:10px; padding-right:10px;"> 
  <div style="border:1px solid #ccc; background:#e5e5e5; padding:10px;">
      <input type="text" id="address">
      <input type="button" value="find" onClick="geosearch()">
    </div>
</div>  --> 

<script type="text/javascript">

var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'map'} }, function(){
  if(navigator.geolocation)
    navigator.geolocation.getCurrentPosition(displayOnMap);
});

function displayOnMap(position){
  var marker = handler.addMarker({
    lat: position.coords.latitude,
    lng: position.coords.longitude,
    infowindow: "hello!"
  });
  handler.map.centerOn(marker);
  handler.getMap().setZoom(12);


};
</script> 

<!-- ignore this for now. I'm trying to play around with searching and returning locations
--> 

<!-- 
<script type="text/javascript">

var geocoder = new google.maps.Geocoder();
//geocode function
geosearch = function() 
{
  var address = $('#address').val();
  geocoder.geocode( { 'address': address}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) 
    {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
        map: map, 
        position: results[0].geometry.location
      });
    } 
    else 
    {
      alert("Geocode was not successful for the following reason: " + status);
    }
  });
}


</script> 
--> 


<%= link_to 'Back', maps_path %>
