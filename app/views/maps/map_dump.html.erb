<% if (@map.ispublic == 1) || (@map.user_id == @user_id) %>
  <% 
  my_hash = { "mapName" => "#{@map.title}" }

  arr = @pins.map{ |pin|
      {
      "markerTitle": pin.title,
      "markerSnippet": pin.description,
      "location": {
          "lat": pin.latitude,
          "lng": pin.longitude,
        },
        "radius": 100,
        "expirationDuration": -1,
        "notificationResponsiveness": 0,
        "GEOFENCE_TRANSITION_ENTER": {
            "sendNotification": true,
            "notificationText": ""
          },
          "GEOFENCE_TRANSITION_DWELL": {
           "loiteringDelay": 30000,
            "sendNotification": true,
            "notificationText": ""
          }, 
         "GEOFENCE_TRANSITION_EXIT": {
          "sendNotification": true,
          "notificationText": ""
          },
      "infoActivityString1": "",
      "infoActivityString2": "", 
      "pinLink": "https://thawing-dusk-70157.herokuapp.com/maps/#{@map.id}/pins/#{pin.id}/pin_dump"

  }
}

my_hash["geofences"] = arr
%>
<pre><%= JSON.pretty_generate(my_hash) %></pre>

<% end %> 